- hosts: all
  become: yes
  pre_tasks:
   - name: Enabling epel repository
     yum:
       name:
          - epel-release
       state: latest
     tags: software

   - name: Install packages
     yum:
       state: latest
       name:
          - zip
          - unzip
          - atop
          - wget
          - mytop
          - htop
          - mc
          - telnet
          - net-tools
     tags: software
   - name: Add IP address of all hosts to all hosts
     lineinfile:
          dest: /etc/hosts
          regexp: '.*{{ item }}$'
          line: "{{ hostvars[item].ansible_host }} {{item}}"
          state: present
     when: hostvars[item].ansible_host is defined
     with_items: "{{ groups.all }}"
     tags: etc_hosts

  vars:
     postgresql_version: 12
     postgresql_ext_install_contrib: yes
     postgresql_listen_addresses: "*"
     postgresql_max_connections: 500
     postgresql_data_directory: "/u01/data"
     postgresql_conf_directory: "{{ postgresql_data_directory }}"
     postgresql_masterpass: postgres123

     postgresql_shared_preload_libraries: 
        - pg_stat_statements
     postgresql_extensions:
        - hstore
        - pg_stat_statements
  roles:
    - role: postgresql

